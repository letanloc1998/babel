<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <!--
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    -->
</head>

<body>
    <div id="root"></div>

    <!--
    <script src="/babel.js"></script>

    <script type="text/babel" data-presets="react" data-type="module" data-plugins="transform-modules-umd"
        src="/App.jsx"></script>
    <script type="text/babel" data-presets="react" data-type="module" data-plugins="transform-modules-umd"
        src="/index.js"></script>
    -->

    <script>
        // window.onload = async () => {}
        window.addEventListener("load", async () => {
            await fetch("https://unpkg.com/react@18/umd/react.development.js")
                .then(response => response.text())
                .then(text => eval(text));

            await fetch(
                "https://unpkg.com/react-dom@18/umd/react-dom.development.js"
            )
                .then(response => response.text())
                .then(text => eval(text));

            // https://unpkg.com/@babel/standalone/babel.min.js
            await fetch("/babel.js")
                .then(response => response.text())
                .then(text => eval(text));

            await fetch("/components/A/index.jsx")
                .then(response => response.text())
                .then(
                    text =>
                        Babel.transform(text, {
                            filename: "componentsA",
                            sourceType: "module",
                            presets: ["react"],
                            plugins: [
                                [
                                    Babel.availablePlugins["transform-modules-umd"],
                                    { exactGlobals: true },
                                ],
                            ],
                        }).code
                )
                // .then(code => code.replace("global.unknown = mod.exports", "global.App = mod.exports"))
                // .then(code => console.log(code))
                .then(code => eval(code));

            await fetch("/App.jsx")
                .then(response => response.text())
                .then(
                    text =>
                        Babel.transform(text, {
                            filename: "App",
                            sourceType: "module",
                            presets: ["react"],
                            plugins: [
                                [
                                    Babel.availablePlugins["transform-modules-umd"],
                                    { exactGlobals: true },
                                ],
                            ],
                        }).code
                )
                // .then(code => code.replace("global.unknown = mod.exports", "global.App = mod.exports"))
                // .then(code => console.log(code))
                .then(code => eval(code));
            await fetch("/index.js")
                .then(response => response.text())
                .then(
                    text =>
                        Babel.transform(text, {
                            filename: "index",
                            sourceType: "module",
                            presets: ["react"],
                            plugins: [
                                [
                                    Babel.availablePlugins["transform-modules-umd"],
                                    { exactGlobals: true },
                                ],
                            ],
                        }).code
                )
                // .then(code => console.log(code))
                .then(code => eval(code));
        });

        Array.from(document.body.getElementsByTagName("script")).forEach(script =>
            script.remove()
        );
        // window.location.href = "/"
    </script>

    <!-- <script>
        history.pushState({}, null, "index.htm");
    </script> -->
</body>

</html>